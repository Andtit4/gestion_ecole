generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model attendance {
  id        String            @id @default(cuid())
  date      DateTime
  status    attendance_status
  studentId String
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  userId    String
  student   student           @relation(fields: [studentId], references: [id])
  user      user              @relation(fields: [userId], references: [id])

  @@index([studentId])
  @@index([userId])
}

/// This model has been renamed to 'Renamedclass' during introspection, because the original name 'class' is reserved.
model Renamedclass {
  id        String     @id @default(cuid())
  name      String
  level     String
  year      Int
  teacherId String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  teacher   teacher?   @relation(fields: [teacherId], references: [id])
  schedule  schedule[]
  students  student[]
  course    course[]   @relation("classtocourse")

  @@index([teacherId], map: "class_teacherId_fkey")
  @@map("class")
}

model course {
  id           String         @id @default(cuid())
  name         String
  description  String?
  coefficient  Float
  level        String
  teacherId    String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  teacher      teacher        @relation(fields: [teacherId], references: [id])
  grades       grade[]
  schedule     schedule[]
  Renamedclass Renamedclass[] @relation("classtocourse")

  @@index([teacherId])
}

model grade {
  id          String     @id @default(cuid())
  value       Float
  type        grade_type
  date        DateTime
  coefficient Float      @default(1)
  comment     String?
  studentId   String
  courseId    String
  teacherId   String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  course      course     @relation(fields: [courseId], references: [id])
  student     student    @relation(fields: [studentId], references: [id])
  teacher     teacher    @relation(fields: [teacherId], references: [id])

  @@index([courseId])
  @@index([studentId])
  @@index([teacherId])
}

model parent {
  id        String          @id @default(cuid())
  userId    String          @unique
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  user      user            @relation(fields: [userId], references: [id], onDelete: Cascade)
  students  parentstudent[]
}

model parentstudent {
  id        String   @id @default(cuid())
  parentId  String
  studentId String
  createdAt DateTime @default(now())
  parent    parent   @relation(fields: [parentId], references: [id], onDelete: Cascade)
  student   student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([parentId, studentId])
  @@index([parentId])
  @@index([studentId])
}

model classroom {
  id          String   @id @default(cuid())
  name        String
  capacity    Int?
  floor       Int?
  building    String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model period {
  id          String       @id @default(cuid())
  type        String
  startDate   DateTime
  endDate     DateTime
  schoolYear  String
  status      String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  reportCards reportcard[]
}

model reportcard {
  id           String   @id @default(cuid())
  periodId     String
  studentId    String
  average      Float
  appreciation String?
  generatedAt  DateTime @default(now())
  status       String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  period       period   @relation(fields: [periodId], references: [id])
  student      student  @relation(fields: [studentId], references: [id])

  @@index([periodId])
  @@index([studentId])
}

model schedule {
  id         String       @id @default(cuid())
  classId    String
  courseId   String
  userId     String
  timeSlotId String
  room       String
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  class      Renamedclass @relation(fields: [classId], references: [id], onDelete: Cascade)
  course     course       @relation(fields: [courseId], references: [id], onDelete: Cascade)
  timeslot   timeslot     @relation(fields: [timeSlotId], references: [id], onDelete: Cascade)
  user       user         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([userId])
  @@index([timeSlotId])
  @@index([classId])
}

model student {
  id          String          @id @default(cuid())
  userId      String          @unique
  classId     String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  attendances attendance[]
  grades      grade[]
  parents     parentstudent[]
  reportCards reportcard[]
  class       Renamedclass?   @relation(fields: [classId], references: [id])
  user        user            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([classId])
}

model teacher {
  id        String         @id @default(cuid())
  userId    String         @unique
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  classes   Renamedclass[]
  courses   course[]
  grades    grade[]
  user      user           @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model timeslot {
  id        String             @id @default(cuid())
  dayOfWeek timeslot_dayOfWeek
  startTime DateTime
  endTime   DateTime
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  schedules schedule[]
}

model user {
  id          String       @id @default(cuid())
  email       String       @unique
  password    String
  role        user_role    @default(STUDENT)
  firstName   String
  lastName    String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  attendances attendance[]
  parent      parent?
  schedules   schedule[]
  student     student?
  teacher     teacher?
}

enum timeslot_dayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum attendance_status {
  PRESENT
  ABSENT
  LATE
  EXCUSED
}

enum user_role {
  ADMIN
  TEACHER
  STUDENT
  PARENT
}

enum grade_type {
  HOMEWORK
  QUIZ
  EXAM
}
